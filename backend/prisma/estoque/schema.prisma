generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/estoque-client"
}

datasource db {
  provider = "sqlite"
  url      = "file:./estoque.db"
}

model Fornecedor {
  id     Int    @id @default(autoincrement())
  nome   String @unique
  
  produtos Produto[]
  entradas Entrada[]
  compras  HistoricoCompra[]
}

model Loja {
  id     Int    @id @default(autoincrement())
  nome   String @unique

  necessidades LojaNecessitaProduto[]
  
  estoque      EstoqueLoja[]
}

model LojaNecessitaProduto {
  id        Int     @id @default(autoincrement())
  
  produtoId Int
  produto   Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  
  lojaId    Int
  loja      Loja    @relation(fields: [lojaId], references: [id], onDelete: Cascade)

  @@unique([produtoId, lojaId])
}



model EstoqueLoja {
  id            Int     @id @default(autoincrement())
  
  produtoId     Int
  produto       Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  
  lojaId        Int
  loja          Loja    @relation(fields: [lojaId], references: [id], onDelete: Cascade)

  
  quantidadeEst Int     @default(0)

  @@unique([produtoId, lojaId]) 
}


model Produto {
  id             Int     @id @default(autoincrement())
  nome           String
  codigo         String? @unique
  corredor       String?
  producao       Boolean @default(false)
  
  marca          String?
  categoria      String?
  unidade        String
  quantidadeMin  Int
  
  
  quantidadeMax  Int     
  observacoes    String?
  ativo          Boolean @default(true)

  fornecedorId   Int
  fornecedor     Fornecedor @relation(fields: [fornecedorId], references: [id])

  entradas       Entrada[]
  saidas         Saida[]
  historicoPreco HistoricoPreco[]
  historicoCompra HistoricoCompra[]
  lojas          LojaNecessitaProduto[]

  
  estoqueLojas   EstoqueLoja[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Entrada {
  id            Int      @id @default(autoincrement())
  produtoId     Int
  produto       Produto  @relation(fields: [produtoId], references: [id])
  quantidade    Int
  data          DateTime @default(now())
  precoPago     Float
  responsavelId Int      

  fornecedorId  Int?
  fornecedor    Fornecedor? @relation(fields: [fornecedorId], references: [id])

  
  lojaId        Int
}

model Saida {
  id            Int      @id @default(autoincrement())
  produtoId     Int
  produto       Produto  @relation(fields: [produtoId], references: [id])
  quantidade    Int
  data          DateTime @default(now())
  responsavelId Int      
  motivo        String?

  
  lojaId        Int
}

model HistoricoPreco {
  id        Int      @id @default(autoincrement())
  produtoId Int
  produto   Produto  @relation(fields: [produtoId], references: [id])
  preco     Float
  data      DateTime @default(now())
}


model HistoricoCompra {
  id                       Int           @id @default(autoincrement())
  produtoId                Int
  produto                  Produto       @relation(fields: [produtoId], references: [id])
  quantidade               Int
  precoTotal               Float
  data                     DateTime      @default(now())
  responsavelId            Int
  confirmadoEntrada        EstadoEntrada @default(PENDENTE)
  responsavelConfirmacaoId Int?

  fornecedorId             Int?
  fornecedor               Fornecedor?   @relation(fields: [fornecedorId], references: [id])
}


enum EstadoEntrada {
  PENDENTE
  CONFIRMADO
  FALTANTE
  CANCELADO
}