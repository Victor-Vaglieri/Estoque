generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/controle-client"
}

datasource db {
  provider = "postgresql"
  //url      = "file:./controle.db"
  url = env("DATABASE_URL_CONTROLE")
}

enum MeioDeContato {
  GOOGLE
  REDE_SOCIAL
  AMIGOS
  LOJA
  OUTROS
}

model CosturaRegistro {
  id                      Int            @id @default(autoincrement())
  rol                     Int            @unique
  nome_cliente            String
  meio_de_contato_inicial MeioDeContato?
  data_recebimento        DateTime?
  data_da_entrega         DateTime?
  itens                   CosturaItem[]
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  lojaId                  Int
}

model CosturaItem {
  id                   Int             @id @default(autoincrement())
  ticket               String
  peca                 String
  descricao_do_servico String
  custo                Float?
  cobrado              Float
  registro             CosturaRegistro @relation(fields: [registroId], references: [id], onDelete: Cascade)
  registroId           Int
}

// --- MODELOS DE TINGIMENTO ---

model TingimentoRegistro {
  // Ordem redefinida conforme solicitado
  id                      Int              @id @default(autoincrement())
  rol                     Int              @unique
  data_recebimento        DateTime?
  nome_cliente            String
  envio_a_washtec         DateTime?
  retorno_da_washtec      DateTime?
  data_da_entrega         DateTime?
  meio_de_contato_inicial MeioDeContato?
  itens                   TingimentoItem[]
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt
  lojaId                  Int
}

model TingimentoItem {
  id             Int                @id @default(autoincrement())
  strip_tag      String
  numero_washtec String?
  peca           String?
  cor_desejada   String?
  valor_washtec  Float
  valor_cobrado  Float
  registro       TingimentoRegistro @relation(fields: [registroId], references: [id], onDelete: Cascade)
  registroId     Int
}

// --- MODELOS DE TAPETE ---

model TapeteRegistro {
  id                Int       @id @default(autoincrement())
  rol               Int       @unique
  data_recebimento  DateTime?
  nome_cliente      String
  os_master         String?
  envio_a_master    DateTime?
  retorno_da_master DateTime?
  data_da_entrega   DateTime?

  meio_de_contato_inicial MeioDeContato?
  itens                   TapeteItem[]
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  lojaId                  Int
}

model TapeteItem {
  id                 Int            @id @default(autoincrement())
  strip_tag_dryclean String
  strip_tag_master   String?
  valor_master       Float
  valor_cobrado      Float
  registro           TapeteRegistro @relation(fields: [registroId], references: [id], onDelete: Cascade)
  registroId         Int
}

// --- NOVOS MODELOS DE MALA (Baseados em Tapete) ---

model MalaRegistro {
  id                      Int            @id @default(autoincrement())
  rol                     Int            @unique
  data_recebimento        DateTime?
  nome_cliente            String
  os_master               String?
  envio_a_master          DateTime?
  retorno_da_master       DateTime?
  data_da_entrega         DateTime?
  meio_de_contato_inicial MeioDeContato?
  itens                   MalaItem[]
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  lojaId                  Int
}

model MalaItem {
  id                 Int          @id @default(autoincrement())
  strip_tag_dryclean String
  strip_tag_master   String?
  valor_master       Float
  valor_cobrado      Float
  registro           MalaRegistro @relation(fields: [registroId], references: [id], onDelete: Cascade)
  registroId         Int
}
